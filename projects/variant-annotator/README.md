# Variant Annotator - A Helper Project

This project provides a Docker Compose environment for running services required to support variant annotation workflows, specifically for the [GA4GH Variation Representation Specification (VRS)](https://pypi.org/project/ga4gh.vrs/0.8.4/). VRS enables precise, computable, and standardized representation of genetic variation, including:

- Validation of variants against the reference genome
- Normalization and canonicalization of variant representations
- Interoperability between tools and databases using a common variant model

This environment is designed to facilitate integration with other NIAGADS genomics projects that require robust, reproducible, and standards-compliant variant annotation infrastructure.

> TODO: In addition to the Docker Compose environment, this project will later contain helper python scripts for annotating specific file types or specialized variant datasets generated by GCAD pipelines (e.g., hipFG standardized datasets, structural variant calls).

## Purpose

The main goal of this project is to define and orchestrate containers for:

- **UTA (Universal Transcript Archive)**: Provides transcript and alignment data for variant normalization and annotation.
- **SeqRepo**: Offers fast, local access to biological sequence data, required for VRS-based normalization and annotation.

These services are essential for tools and APIs that implement or depend on GA4GH VRS, enabling consistent and reproducible variant representation.

## Usage

1. **Clone this repository** (or ensure it is available as a submodule/dependency in your project).
   - Alternatively, you can use [git sparse checkout](https://git-scm.com/docs/git-sparse-checkout) to check out only the `projects/variant-annotator` directory if you do not need the entire codebase:

   ```bash
   git clone <repo-url>
   cd niagads-pylib
   git sparse-checkout init --cone
   git sparse-checkout set projects/variant-annotator
   ```

2. **Configure Volume Mounts**

- Edit the provided `.env` file to specify host paths for persistent data volumes (e.g., for UTA and SeqRepo data directories).
- Volume mounts are defined in `docker-compose.yaml` and are not passed via the command line, in accordance with [GA4GH VRS documentation](https://pypi.org/project/ga4gh.vrs/0.8.4/).

1. **Start the Services**

- Run `docker-compose up -d` in this directory to launch all required containers.

## Integration

This project is intended to be used as a dependency by other projects in the codebase, including:

- `genomicsdb-loader`
- `open-access-api` (potentially)

These projects can rely on the services defined here for variant normalization and annotation tasks.

## Configuration

Copy `sample.env` to `.env`.  **DO NOT RENAME**

- **.env file**: The `.env` file is used to configure the environment variables required by the `docker-compose.yaml` file. Below are the variables you need to define:

  - `HOST_SEQREPO_DATA_DIR`: Absolute path to the SeqRepo data directory on the host machine. This directory contains the biological sequence data required by the SeqRepo services.
  - `HOST_UTA_DATA_DIR`: Absolute path to the UTA data directory on the host machine. This directory stores the PostgreSQL database files for the UTA service.
  - `HOST_SEQREPO_SERVICE_PORT`: The port on the host machine to bind the SeqRepo REST service. Default is `5000`.
  - `HOST_UTA_SERVICE_PORT`: The port on the host machine to bind the UTA service. Default is `5432`.
  - `UTA_PGADMIN_PWD`: The password for the PostgreSQL database used by the UTA service. You can replace `UtaVar1a` with a secure password or leave as is if service is only deployed locally.

- **docker-compose.yaml**: Defines the containers, networks, and volume mounts. No need to modify unless customizing service definitions.

## Monitor Idle Containers

The `monitor_idle_containers.sh` script is a utility to monitor Docker containers for inactivity and stop them if they remain idle for a specified period. This is useful for managing resource usage and ensuring that idle containers do not consume unnecessary resources.

- Monitors specified Docker containers for network activity.
- Stops containers that remain idle for a configurable timeout period.
- Configurable via command-line flags for idle timeout, check interval, and containers to monitor.

### Usage

Run the script with the desired options. Defaults are provided if no options are specified.

```bash
./monitor_idle_containers.sh [OPTIONS]
```

- `--days <number>`: Set the idle timeout in days (default: 2).
- `--check-interval <seconds>`: Set the interval in seconds to check for idle containers (default: 3600 seconds).
- `--containers <list>`: Comma-separated list of container names to monitor (default: `seqrepo,seqrepo-rest-service,uta`).
- `--help`: Display the help message and exit.

To run the script in the background and monitor `seqrepo` and `uta` containers with a 3-day idle timeout and a 2-hour check interval:

```bash
nohup ./monitor_idle_containers.sh --days 3 --check-interval 7200 --containers "seqrepo,uta" > monitor_idle.log 2>&1 &
```

This will:

- Monitor the `seqrepo` and `uta` containers.
- Stop them if they remain idle for 3 days.
- Check their activity every 2 hours.
- Log the output to `monitor_idle.log`.

For more details, run:

```bash
./monitor_idle_containers.sh --help
```

## References

- [GA4GH VRS PyPI](https://pypi.org/project/ga4gh.vrs/0.8.4/)
- [UTA Documentation](https://github.com/biocommons/uta)
- [SeqRepo Documentation](https://github.com/biocommons/seqrepo)

---

For questions or integration help, contact the NIAGADS team.
